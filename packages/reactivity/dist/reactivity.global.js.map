{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts", "../src/index.ts"],
  "sourcesContent": ["// \u5224\u65AD\u5BF9\u8C61\r\nexport const isObject = (value):boolean => {\r\n    return typeof value === 'object' && value !== null\r\n}", "// effect \u65B9\u6CD5\u63A5\u6536\u4E00\u4E2A\u51FD\u6570\u4F5C\u4E3A\u53C2\u6570\u3002\r\n// \u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u4F1A\u5F71\u54CD\u5176\u4ED6\u51FD\u6570\u6267\u884C\uFF0C\u6267\u884C\u65F6\u673A\uFF1A\u4E00\u662F\u9875\u9762\u9996\u6B21\u6E32\u67D3\u65F6\uFF0C\u4E8C\u662F\u5B83\u4F9D\u8D56\u7684\u6570\u636E\u66F4\u65B0\u65F6\u3002\r\n\r\nexport let activeEffect = undefined;\r\n\r\nexport function effect(fn) {\r\n    // effect \u65B9\u6CD5\u63A5\u6536\u4E00\u4E2A\u51FD\u6570\u53C2\u6570\uFF0C\u9700\u8981\u5C06\u5176\u4FDD\u5B58\uFF0C\u5E76\u6267\u884C\u4E00\u6B21\uFF1B\u4EE5\u540E\u8FD8\u4F1A\u6269\u5C55\u51FA\u66F4\u591A\u7684\u529F\u80FD\uFF0C\u6240\u4EE5\u5C06\u5176\u5C01\u88C5\u4E3A\u4E00\u4E2A ReactiveEffect \u7C7B\u8FDB\u884C\u7EF4\u62A4\r\n    const _effect = new ReactiveEffect(fn)\r\n    _effect.run()\r\n}\r\n\r\nclass ReactiveEffect {\r\n    // \u8FD9\u91CC\u8868\u793A\u5728\u5B9E\u4F8B\u4E0A\u65B0\u589E\u4E86active\u5C5E\u6027\r\n    public active = true; // \u8FD9\u4E2Aactive\u9ED8\u8BA4\u662F\u6FC0\u6D3B\u72B6\u6001\r\n    constructor(public fn){\r\n        this.fn = fn;\r\n    } // \u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u4E5F\u4F1A\u5728this\u4E0A\uFF0Cthis.fn = fn; \r\n\r\n    run() { // run \u5C31\u662F\u6267\u884Ceffect\r\n        if(!this.active) {this.fn()}; // \u8FD9\u91CC\u8868\u793A\u5982\u679C\u662F\u975E\u6FC0\u6D3B\u7684\u60C5\u51B5\uFF0C\u53EA\u9700\u8981\u6267\u884C\u51FD\u6570\uFF0C\u4E0D\u9700\u8981\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\r\n\r\n        // \u8FD9\u91CC\u9700\u8981\u4F9D\u8D56\u6536\u96C6\uFF0C\u6838\u5FC3\u5C31\u662F\u5C06\u5F53\u524D\u7684effect\u548C\u7A0D\u540E\u6E32\u67D3\u7684\u5C5E\u6027\u5173\u8054\u5728\u4E00\u8D77\r\n        try{\r\n            activeEffect = this;\r\n            return this.fn(); // \u5F53\u7A0D\u540E\u8C03\u7528\u53D6\u503C\u64CD\u4F5C\u7684\u65F6\u5019\uFF0C\u5C31\u53EF\u4EE5\u83B7\u53D6\u5230\u8FD9\u4E2A\u5168\u5C40\u7684activeEffect\u4E86\r\n        } finally {\r\n            activeEffect = undefined;\r\n        }\r\n    }\r\n}\r\n\r\n// \u5B58\u50A8\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\uFF0C\u5305\u542B target\u3001key \u548C _effect\r\nconst targetMap = new WeakMap\r\n\r\n/**\r\n * \u4F9D\u8D56\u6536\u96C6\u3002\u5173\u8054\u5BF9\u8C61\u3001\u5C5E\u6027\u548C _effect\u3002\r\n */\r\nexport function track(target, key) {\r\n    if(!activeEffect) return\r\n\r\n    // \u4ECE\u7F13\u5B58\u4E2D\u627E\u5230 target \u5BF9\u8C61\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\r\n    let depsMap = targetMap.get(target)\r\n    if(!depsMap) {\r\n        targetMap.set(target, depsMap = new Map)\r\n    }\r\n    // \u518D\u627E\u5230\u5C5E\u6027 key \u6240\u5BF9\u5E94\u7684 _effect\u96C6\u5408\r\n    let deps = depsMap.get(key)\r\n    if(!deps) {\r\n        depsMap.set(key, deps = new Set)\r\n    }\r\n \r\n    // \u5982\u679C _effect \u5DF2\u7ECF\u88AB\u6536\u96C6\u8FC7\u4E86\uFF0C\u5219\u4E0D\u518D\u6536\u96C6\r\n    let shouldTrack = !deps.has(activeEffect)\r\n    if(shouldTrack) {\r\n        deps.add(activeEffect)\r\n    }\r\n}\r\n\r\n// \u5B9E\u73B0\u6D3E\u53D1\u66F4\u65B0\uFF1A\u5B9E\u73B0effect\u5143\u7D20\u6539\u53D8\u66F4\u65B0\u9875\u9762\u6E32\u67D3\r\nexport function trigger(target, key) {\r\n    // \u627E\u5230 target \u7684\u6240\u6709\u4F9D\u8D56\r\n    let depsMap = targetMap.get(target)\r\n    if(!depsMap) {\r\n        return \r\n    }\r\n\r\n    // \u5C5E\u6027\u4F9D\u8D56\u7684 _effect \u5217\u8868\r\n    let effects = depsMap.get(key)\r\n    if(effects) {\r\n        // \u5C5E\u6027\u7684\u503C\u53D1\u751F\u53D8\u5316\uFF0C\u627E\u5230\u5B83\u4F9D\u8D56\u7684 _effect \u5217\u8868\uFF0C\u8BA9\u6240\u6709\u7684 _effect \u4F9D\u6B21\u6267\u884C\r\n        effects.forEach(effect => {\r\n            effect.run()\r\n        })\r\n    }\r\n}", "import { track, trigger } from './effect'\r\n\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\n// 1) \u5B9E\u540C\u4E00\u4E2A\u5BF9\u8C61\u4EE3\u7406\u591A\u6B21\uFF0C\u8FD4\u56DE\u540C\u4E00\u4E2A\u4EE3\u7406\r\n// 2) \u4EE3\u7406\u5BF9\u8C61\u88AB\u518D\u6B21\u4EE3\u7406\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8FD4\u56DE\r\nexport const mutableHandles = { // \u5F53\u6CA1\u6709\u91CD\u65B0\u5B9A\u4E49\u5C5E\u6027\uFF0C\u53EA\u662F\u4EE3\u7406\uFF0C\u5728\u53D6\u503C\u7684\u65F6\u5019\u4F1A\u8C03\u7528get\uFF0C\u5F53\u8D4B\u503C\u7684\u65F6\u5019\u4F1A\u8C03\u7528set\r\n    get(target, key, receiver) {\r\n        // \u8BBF\u95EE\u5230 __v_isReactive \u5C5E\u6027\u65F6\uFF0C\u8BF4\u660E\u6B64\u65F6\u7684 target \u5176\u5B9E\u662F\u4E00\u4E2A proxy \u5BF9\u8C61\uFF0C\u65E0\u9700\u518D\u88AB\u4EE3\u7406\r\n        if(key === ReactiveFlags.IS_REACTIVE) return true;\r\n\r\n        // \u53BB\u4EE3\u7406\u5BF9\u8C61\u4E0A\u53D6\u503C\uFF0C\u5C31\u8D70get \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u7528\u6237\u53D6\u503C\r\n        console.log(`${key}\u5C5E\u6027\u88AB\u8BBF\u95EE\uFF0C\u4F9D\u8D56\u6536\u96C6`)\r\n\r\n        // \u4F9D\u8D56\u6536\u96C6\uFF0C\u8BA9 target, key \u548C \u5F53\u524D\u7684 _effect \u5173\u8054\u8D77\u6765\r\n        track(target, key)\r\n\r\n        return Reflect.get(target, key, receiver);// receiver \u6539\u53D8\u8C03\u7528\u53D6\u503C\u7684this\u5BF9\u8C61\uFF0C\u4E0D\u7528\u4F1A\u51FA\u73B0\u5982\u4E0B\u60C5\u51B5this\u95EE\u9898\r\n        \r\n        // return target[key]\r\n        // \u5047\u5982\u6709\u4E00\u4E2A\u5BF9\u8C61: let target = { name: 'zf', get alias() { return this.name }}; // alias\uFF0Ces5\u53D6\u5C5E\u6027\u503C\r\n        // \u5E76\u8C03\u7528 proxy.alias\uFF0C\u6B64\u65F6\u5728alias\u4E0A\u53D6\u4E86\u503C\uFF0C\u4E5F\u53BB\u4E86name\uFF0C\u4F46\u662F\u6CA1\u6709\u76D1\u63A7\u5230name\uFF0C\r\n        // this\u4F1A\u53D8\u6210target\uFF0C\u800C\u4E0D\u662F\u4EE3\u7406\u5BF9\u8C61\uFF0C\u6B64\u65F6\u4E0D\u4F1A\u8FDB\u884Cproxy\u4EE3\u7406\r\n    },\r\n    set(target, key, value, receiver) {\r\n        console.log(`${key}\u5C5E\u6027\u53D8\u5316\u4E86\uFF0C\u6D3E\u53D1\u66F4\u65B0`);\r\n\r\n        // \u6D3E\u53D1\u66F4\u65B0\uFF0C\u901A\u77E5 target \u7684\u5C5E\u6027\uFF0C\u8BA9\u4F9D\u8D56\u5B83\u7684 _effect \u518D\u6B21\u6267\u884C\r\n        trigger(target, key);\r\n\r\n        // \u53BB\u4EE3\u7406\u4E0A\u8BBE\u7F6E\u503C\uFF0C\u5C31\u8D70set\uFF0C\u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u7528\u6237\u8BBE\u7F6E\u503C\r\n        return Reflect.set(target, key, value, receiver);\r\n    }\r\n}", "// \u4F7F\u7528 reactive \u65F6\u9700\u8981\u6CE8\u610F\u7684\u5730\u65B9\uFF1A\r\n\r\n// \u53EA\u80FD\u5B9E\u73B0\u5BF9\u8C61\u6570\u636E\u7684\u54CD\u5E94\u5F0F\r\n// \u540C\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u53EA\u4F1A\u88AB\u4EE3\u7406\u4E00\u6B21\r\n// \u88AB\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\uFF0C\u4E0D\u4F1A\u88AB\u518D\u6B21\u4EE3\u7406\r\n// \u652F\u6301\u5D4C\u5957\u5C5E\u6027\u7684\u54CD\u5E94\u5F0F\r\n\r\nimport { isObject } from '@myvue/shared';\r\nimport { mutableHandles, ReactiveFlags } from './baseHandler'\r\n// \u5C06\u6570\u636E\u8F6C\u5316\u4E3A\u54CD\u5E94\u5F0F\u7684\u6570\u636E\uFF0C\u53EA\u80FD\u505A\u5BF9\u8C61\u7684\u4EE3\u7406\r\nconst reactiveMap = new WeakMap(); // \u6301\u6709\u7684\u662F\u6BCF\u4E2A\u952E\u5BF9\u8C61\u7684\u201C\u5F31\u5F15\u7528\u201D\uFF0C\u7528\u4E8E\u5783\u573E\u56DE\u6536\uFF0C\u76F8\u6BD4\u4E8Emap\r\n// \u7F13\u5B58\u673A\u5236// key\u53EA\u80FD\u662F\u5BF9\u8C61\r\n\r\nexport function reactive(target) {\r\n    if(!isObject(target))  return;\r\n    // Vue2 \u4E2D\u901A\u8FC7\u7ED9 Observer \u5B9E\u4F8B \u589E\u52A0\u4E00\u4E2A__ob__\u5C5E\u6027\u4F5C\u4E3A\u6807\u8BC6\uFF0C\u8868\u793A\u5B83\u5DF2\u7ECF\u88AB\u89C2\u6D4B\u8FC7\u4E86\uFF0C\u65E0\u9700\u518D\u88AB\u89C2\u6D4B\u3002Vue3 \u662F\u901A\u8FC7\u7ED9 proxy \u5BF9\u8C61\u589E\u52A0\u4E00\u4E2A__v_isReactive \u5C5E\u6027\uFF0C\u8868\u793A\u8BE5 proxy \u5BF9\u8C61\u5DF2\u7ECF\u662F\u54CD\u5E94\u5F0F\u6570\u636E\u4E86\uFF0C\u4ECE\u800C\u65E0\u9700\u518D\u88AB\u4EE3\u7406\uFF1A\r\n    if(target[ReactiveFlags.IS_REACTIVE]) return target; // \u5982\u679C\u76EE\u6807\u662F\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61\uFF0C\u5219\u4E00\u5B9A\u88AB\u4EE3\u7406\u8FC7\u4E86\uFF0C\u4F1A\u8D70get(ReactiveFlags.IS_REACTIVE)\r\n\r\n    // \u5224\u65AD target \u662F\u5426\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n    // \u6BCF\u5F53\u4E00\u4E2A target \u9700\u8981\u54CD\u5E94\u5F0F\u65F6\uFF0C\u5148\u5224\u65AD\u5176\u6709\u6CA1\u6709\u8BE5\u5C5E\u6027\u3002\u6B64\u65F6\u4EA7\u751F\u5C5E\u6027\u8BBF\u95EE\u64CD\u4F5C\uFF0C\u5982\u679C target \u88AB\u4EE3\u7406\u8FC7\uFF0C\u5219\u4F1A\u8FDB\u5165\u4E0B\u9762\u7684 get \u65B9\u6CD5\u4E2D\uFF0C\u505A\u8FDB\u4E00\u6B65\u7684\u5224\u65AD\u3002   \r\n    let exisitingProxy = reactiveMap.get(target);\r\n    if(exisitingProxy) return exisitingProxy;\r\n    // \u7B2C\u4E00\u6B21\u666E\u901A\u5BF9\u8C61\u4EE3\u7406\uFF0C\u6211\u4EEC\u4F1A\u901A\u8FC7new Proxy\u4EE3\u7406\u4E00\u6B21\r\n    // \u4E0B\u4E00\u6B21\u4F60\u4F20\u9012\u7684\u662Fproxy\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u4E00\u4E0B\u6709\u6CA1\u6709\u88AB\u4EE3\u7406\u8FC7\uFF0C\u5982\u679C\u8BBF\u95EE\u4E2D\u6709proxy\uFF0C\u6709get\u65B9\u6CD5\u5C31\u8BC1\u660E\u88AB\u8BBF\u95EE\u8FC7\u4E86\r\n    \r\n    const proxy = new Proxy(target, mutableHandles)\r\n\r\n    reactiveMap.set(target, proxy); // \u52A0\u4E00\u4E2A\u6807\u5FD7\r\n    return proxy;\r\n}", "import { isObject } from \"@myvue/shared\";\r\nimport { reactive } from \"./reactive\"\r\nimport { effect } from \"./effect\"\r\n\r\nconsole.log(isObject([]));\r\n\r\nconst obj = {\r\n    name: '\u67EF\u5170\u829D',\r\n    age: 19\r\n}\r\nconst person = reactive(obj)\r\neffect(() => {\r\n    console.log(person.name) // \u6797\u6D69\u626C\r\n})\r\nsetTimeout(() => {\r\n    person.name = '\u6211\u662F\u5927\u50BB\u903C'\r\n}, 1000)\r\n\r\nperson.name = '\u6797\u6D69\u626C'\r\n\r\nperson.age = 20\r\nconsole.log(person.age)"],
  "mappings": ";;AACO,MAAM,WAAW,CAAC,UAAkB;AACvC,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAClD;;;ACAO,MAAI,eAAe;AAEnB,WAAS,OAAO,IAAI;AAEvB,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EAChB;AAEA,MAAM,iBAAN,MAAqB;AAAA,IAGjB,YAAmB,IAAG;AAAH;AADnB,WAAO,SAAS;AAEZ,WAAK,KAAK;AAAA,IACd;AAAA,IAEA,MAAM;AACF,UAAG,CAAC,KAAK,QAAQ;AAAC,aAAK,GAAG;AAAA,MAAC;AAAC;AAG5B,UAAG;AACC,uBAAe;AACf,eAAO,KAAK,GAAG;AAAA,MACnB,UAAE;AACE,uBAAe;AAAA,MACnB;AAAA,IACJ;AAAA,EACJ;AAGA,MAAM,YAAY,oBAAI;AAKf,WAAS,MAAM,QAAQ,KAAK;AAC/B,QAAG,CAAC;AAAc;AAGlB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAS;AACT,gBAAU,IAAI,QAAQ,UAAU,oBAAI,KAAG;AAAA,IAC3C;AAEA,QAAI,OAAO,QAAQ,IAAI,GAAG;AAC1B,QAAG,CAAC,MAAM;AACN,cAAQ,IAAI,KAAK,OAAO,oBAAI,KAAG;AAAA,IACnC;AAGA,QAAI,cAAc,CAAC,KAAK,IAAI,YAAY;AACxC,QAAG,aAAa;AACZ,WAAK,IAAI,YAAY;AAAA,IACzB;AAAA,EACJ;AAGO,WAAS,QAAQ,QAAQ,KAAK;AAEjC,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAS;AACT;AAAA,IACJ;AAGA,QAAI,UAAU,QAAQ,IAAI,GAAG;AAC7B,QAAG,SAAS;AAER,cAAQ,QAAQ,CAAAA,YAAU;AACtB,QAAAA,QAAO,IAAI;AAAA,MACf,CAAC;AAAA,IACL;AAAA,EACJ;;;ACnEO,MAAM,iBAAiB;AAAA,IAC1B,IAAI,QAAQ,KAAK,UAAU;AAEvB,UAAG,QAAQ;AAA2B,eAAO;AAG7C,cAAQ,IAAI,GAAG,iEAAe;AAG9B,YAAM,QAAQ,GAAG;AAEjB,aAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,IAM5C;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAC9B,cAAQ,IAAI,GAAG,iEAAe;AAG9B,cAAQ,QAAQ,GAAG;AAGnB,aAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,IACnD;AAAA,EACJ;;;ACxBA,MAAM,cAAc,oBAAI,QAAQ;AAGzB,WAAS,SAAS,QAAQ;AAC7B,QAAG,CAAC,SAAS,MAAM;AAAI;AAEvB,QAAG;AAAmC,aAAO;AAI7C,QAAI,iBAAiB,YAAY,IAAI,MAAM;AAC3C,QAAG;AAAgB,aAAO;AAI1B,UAAM,QAAQ,IAAI,MAAM,QAAQ,cAAc;AAE9C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACX;;;ACzBA,UAAQ,IAAI,SAAS,CAAC,CAAC,CAAC;AAExB,MAAM,MAAM;AAAA,IACR,MAAM;AAAA,IACN,KAAK;AAAA,EACT;AACA,MAAM,SAAS,SAAS,GAAG;AAC3B,SAAO,MAAM;AACT,YAAQ,IAAI,OAAO,IAAI;AAAA,EAC3B,CAAC;AACD,aAAW,MAAM;AACb,WAAO,OAAO;AAAA,EAClB,GAAG,GAAI;AAEP,SAAO,OAAO;AAEd,SAAO,MAAM;AACb,UAAQ,IAAI,OAAO,GAAG;",
  "names": ["effect"]
}
